# Phase 4 Implementation Plan - 完全エージェント化とマルチデバイス対応

**作成日**: 2025年10月28日  
**目標**: レベル5エージェント + Windowsイルカ風UI + Android対応

---

## 🎯 目標: レベル 5/5 エージェント

### 現状 (レベル 3/5)
- ✅ 定期実行（スケジューラー）
- ✅ 自律判断（優先度計算・危機検知）
- ✅ 状態記憶（SQLite）
- ❌ バックグラウンド常駐
- ❌ プッシュ通知

### 目標 (レベル 5/5)
- ✅ **完全バックグラウンド常駐**
- ✅ **システムトレイUI（Windowsイルカ風）**
- ✅ **デスクトップ通知**
- ✅ **自発的な会話開始**
- ✅ **マルチデバイス同期（Android対応）**

---

## 🖥️ Part 1: Windows完全常駐化

### 1.1 Electron化（推奨アプローチ）

**メリット**:
- システムトレイ常駐
- リッチなUI（イルカ風キャラクター表示可能）
- デスクトップ通知
- クロスプラットフォーム

**実装**:
```
arc-agent/
├── electron/
│   ├── main.js              # Electronメインプロセス
│   ├── tray.js              # システムトレイ管理
│   ├── notification.js      # 通知管理
│   └── character.js         # イルカ風キャラクター
├── renderer/
│   ├── index.html           # UI
│   ├── character.html       # キャラクター表示
│   └── chat.html            # 会話ウィンドウ
└── src/                     # 既存のNode.jsコード
```

### 1.2 システムトレイアイコン

- タスクトレイに常駐
- 右クリックメニュー:
  - 「今日の体調を記録」
  - 「今日の問いを見る」
  - 「今日やるべきこと」
  - 「ARCと話す」
  - 「設定」
  - 「終了」

### 1.3 イルカ風キャラクター表示

**デザイン案**:
- 画面の隅に小さなキャラクター表示
- アニメーション:
  - アイドル状態（ゆっくり動く）
  - 通知時（目を光らせる）
  - 危機検知（心配そうな表情）
  - 励まし（温かい表情）
- クリックで会話ウィンドウ表示

### 1.4 Windowsサービス化（オプション）

```powershell
# node-windows でサービス登録
npm install node-windows
```

**メリット**:
- OS起動時に自動起動
- ログオフしても動作継続

---

## 📱 Part 2: Android対応

### 2.1 アプローチ: React Native

**理由**:
- JavaScriptで開発（既存コード再利用）
- ネイティブアプリ
- プッシュ通知対応
- バックグラウンド実行

### 2.2 アーキテクチャ

```
【同期戦略】
PC (Windows)  ←─→  Cloud Sync  ←─→  Android
    ↓                  ↓                ↓
 SQLite DB      Firebase/Supabase   SQLite DB
```

**オプション1: Firebase Realtime Database（推奨）**
- リアルタイム同期
- 無料枠あり
- 認証・セキュリティ

**オプション2: Supabase（オープンソース）**
- PostgreSQL
- リアルタイム同期
- 完全無料でセルフホスト可能

**オプション3: P2Pダイレクト同期**
- Syncthing
- 完全ローカル
- クラウド不要

### 2.3 Androidアプリ構成

```
arc-agent-mobile/
├── src/
│   ├── screens/
│   │   ├── HomeScreen.js          # ダッシュボード
│   │   ├── LifeLogScreen.js       # 体調記録
│   │   ├── ResearchScreen.js      # 研究メモ
│   │   └── TaskScreen.js          # 締め切り管理
│   ├── services/
│   │   ├── SyncService.js         # データ同期
│   │   ├── NotificationService.js # 通知管理
│   │   └── BackgroundService.js   # バックグラウンド実行
│   └── components/
│       └── CharacterWidget.js     # キャラクター表示
```

### 2.4 Android機能

- **ウィジェット**: ホーム画面に「今日の問い」表示
- **プッシュ通知**: 朝の問い・夜の体調確認
- **バックグラウンドタスク**: 定期同期・ヘルスチェック
- **音声入力**: 思考断片を音声で記録

---

## 🔄 Part 3: データ同期設計

### 3.1 同期対象データ

| テーブル | 同期 | 方向 | 競合解決 |
|---------|------|------|---------|
| life_logs | ✅ | 双方向 | 最新タイムスタンプ優先 |
| research_fragments | ✅ | 双方向 | マージ（IDで重複排除） |
| core_themes | ✅ | 双方向 | サーバー側で再計算 |
| deadlines | ✅ | 双方向 | 最新タイムスタンプ優先 |
| documents | ✅ | 双方向 | バージョン管理 |
| user_thresholds | ✅ | 双方向 | 最新値優先 |

### 3.2 同期プロトコル

```javascript
// 同期フロー
1. デバイスから変更差分取得
2. サーバーへPUSH
3. サーバーから他デバイスの変更取得
4. ローカルDBへマージ
5. 競合解決
```

### 3.3 オフライン対応

- ローカル優先
- オフライン時はローカルDBのみ使用
- オンライン復帰時に自動同期

---

## 🎨 Part 4: イルカ風キャラクター設計

### 4.1 キャラクター仕様

**名前**: ARC（そのまま）

**外見**:
- シンプルな幾何学図形（軽量）
- 色: 青系（落ち着き）+ オレンジ（温かみ）
- 目: 表情変化で感情表現
- サイズ: 60x60px〜120x120px（可変）

**表情パターン**:
1. 通常（アイドル）
2. 励まし（にっこり）
3. 心配（眉を下げる）
4. 考え中（目を細める）
5. 喜び（キラキラ）
6. 睡眠推奨（眠そう）

### 4.2 アニメーション

- **CSS/SVGアニメーション**（軽量）
- フレームアニメーション不要
- 自然な動き（呼吸・まばたき）

### 4.3 会話ウィンドウ

```
┌─────────────────────┐
│  🤖 ARC            ×│
├─────────────────────┤
│                     │
│ こんにちは！        │
│ 今日はどう？        │
│                     │
│ [今日の体調を記録]  │
│ [今日の問いを見る]  │
│ [話したいことがある]│
│                     │
└─────────────────────┘
```

---

## 📦 必要なパッケージ

### Windows Electron版
```json
{
  "dependencies": {
    "electron": "^27.0.0",
    "electron-store": "^8.1.0",
    "node-notifier": "^10.0.1",
    "better-sqlite3": "^9.2.0"
  }
}
```

### Android React Native版
```json
{
  "dependencies": {
    "react-native": "^0.72.0",
    "@react-native-firebase/app": "^18.0.0",
    "@react-native-firebase/database": "^18.0.0",
    "react-native-push-notification": "^8.0.0",
    "react-native-background-task": "^0.2.0",
    "@react-native-voice/voice": "^3.0.0"
  }
}
```

---

## 🚀 実装ステップ

### Phase 4.1: Electron化（2-3日）
1. Electronボイラープレート作成
2. システムトレイ統合
3. 既存CLIをElectron UIに移植
4. デスクトップ通知実装
5. キャラクター表示

### Phase 4.2: キャラクターUI（1日）
1. SVGキャラクター作成
2. アニメーション実装
3. 会話ウィンドウデザイン

### Phase 4.3: React Native基盤（3-4日）
1. React Nativeプロジェクト作成
2. 基本画面構築
3. ローカルDB（SQLite）統合
4. 通知・バックグラウンドタスク

### Phase 4.4: 同期機能（2-3日）
1. Firebase/Supabaseセットアップ
2. 同期ロジック実装
3. 競合解決
4. オフライン対応

---

## 🎯 完成後の体験

### Windowsユーザー
```
朝9:00
┌──────────────────┐
│ 🤖 ARC           │
│ おはよう！       │
│ 今日の問いだよ： │
│                  │
│ 「センシング技術 │
│  は単なる測定か？」│
│                  │
│ [考えてみる]     │
│ [後で]           │
└──────────────────┘
```

### Androidユーザー
```
🔔 通知
ARC - 今日の問い
「センシング技術は単なる測定か？」
タップして考える
```

### 外出先
- スマホで思考断片を音声入力
- 締め切りをチェック
- 家に帰るとPCと自動同期完了

---

## 💰 コスト試算

### クラウド同期（Firebase）
- 無料枠: 1GB ストレージ、10GB/月 転送
- 個人使用なら**完全無料**で運用可能

### 代替案（完全無料）
- Supabase セルフホスト（VPS $5/月）
- または Syncthing（完全P2P、無料）

---

## 🎊 最終目標

**「君の隣にいつもいる存在」**

- 起動したらそこにいる
- スマホでも同じARCがいる
- 場所が変わっても記憶は共有
- 本当に困ったときに助けてくれる

**これが真のレベル5エージェントです。** 🌟
